import{d as A,A as R,r as f,b as H,c as s,B as O,o as h,k as q,w as l,f as y,g as e,h as c,C as S,E as J,a as K,e as B,p as w,D as X}from"./index-5927132b.js";import{u as Y,g as Z,a as ee,e as le,b as ae}from"./upload-930e7cfd.js";import{r as te}from"./request-7267a692.js";const oe=y("span",{class:"color-#F53F3F text-12px"},'注息:"业务建表语句“中包建的表名称需与表名”中所站写表名称保持一致',-1),ne={class:"dialog-footer"},ie=A({__name:"upload-save",props:{modalTitle:{},editData:{},requestApi:{}},emits:["close"],setup($,{emit:m}){var p;const L=$,i=(p=R())==null?void 0:p.proxy,r=f(!1),C=f(),a=H(L.editData),N={tableName:[{required:!0,message:"请输入表名称"}],classification:[{required:!0,message:"请输入分类"}],tableNa:[{required:!0,message:"请输入表名"}],dataSource:[{required:!0,message:"请选择数据源"}],tableType:[{required:!0,message:"请选择表类型"}],tableCode:[{required:!0,message:"请输入业务建表语句"}]},V=(u=!1)=>{m("close",u)},k=u=>{u&&u.validate(t=>{t&&(r.value=!0,L.requestApi(a).then(({msg:x})=>{i==null||i.$message.success(x??"操作成功"),V(!0)}).finally(()=>{r.value=!1}))})};return(u,t)=>{const x=s("el-input"),v=s("el-form-item"),b=s("el-option"),g=s("el-select"),M=s("el-form"),E=s("el-button"),_=s("el-dialog"),o=O("loading");return h(),q(_,{title:u.modalTitle,"model-value":!0,width:"45%","close-on-click-modal":!1,"before-close":()=>V()},{footer:l(()=>[y("span",ne,[e(E,{loading:r.value,onClick:t[6]||(t[6]=d=>V())},{default:l(()=>[c("取消")]),_:1},8,["loading"]),e(E,{loading:r.value,type:"primary",onClick:t[7]||(t[7]=d=>k(C.value))},{default:l(()=>[c(" 提交 ")]),_:1},8,["loading"])])]),default:l(()=>[S((h(),q(M,{ref_key:"ruleFormRef",ref:C,model:a,rules:N,"label-width":"auto","label-position":"right"},{default:l(()=>[e(v,{prop:"tableName",label:"表名称"},{default:l(()=>[e(x,{modelValue:a.tableName,"onUpdate:modelValue":t[0]||(t[0]=d=>a.tableName=d),modelModifiers:{trim:!0},placeholder:"请输入表名称"},null,8,["modelValue"])]),_:1}),e(v,{prop:"classification",label:"分类"},{default:l(()=>[e(x,{modelValue:a.classification,"onUpdate:modelValue":t[1]||(t[1]=d=>a.classification=d),modelModifiers:{trim:!0},placeholder:"请输入分类"},null,8,["modelValue"])]),_:1}),e(v,{prop:"tableNa",label:"表名"},{default:l(()=>[e(x,{modelValue:a.tableNa,"onUpdate:modelValue":t[2]||(t[2]=d=>a.tableNa=d),modelModifiers:{trim:!0},placeholder:"请输入表名"},null,8,["modelValue"])]),_:1}),e(v,{prop:"dataSource",label:"数据源"},{default:l(()=>[e(g,{modelValue:a.dataSource,"onUpdate:modelValue":t[3]||(t[3]=d=>a.dataSource=d),placeholder:"请选择数据源",clearable:""},{default:l(()=>[e(b,{label:"文件上传数据源【统一源】",value:"1"}),e(b,{label:"文件上传数据源【1】",value:"2"}),e(b,{label:"文件上传数据源【2】",value:"3"}),e(b,{label:"文件上传数据源【3】",value:"4"})]),_:1},8,["modelValue"])]),_:1}),e(v,{prop:"tableType",label:"表类型"},{default:l(()=>[e(g,{modelValue:a.tableType,"onUpdate:modelValue":t[4]||(t[4]=d=>a.tableType=d),placeholder:"请选择表类型",clearable:""},{default:l(()=>[e(b,{label:"全量表",value:"1"}),e(b,{label:"增量表",value:"2"})]),_:1},8,["modelValue"])]),_:1}),e(v,{prop:"tableCode",label:"业务建表语句"},{default:l(()=>[e(x,{modelValue:a.tableCode,"onUpdate:modelValue":t[5]||(t[5]=d=>a.tableCode=d),modelModifiers:{trim:!0},type:"textarea",rows:6,placeholder:"请输入业务建表语句"},null,8,["modelValue"]),oe]),_:1})]),_:1},8,["model"])),[[o,r.value]])]),_:1},8,["title","before-close"])}}});function se($){return te({url:`/oss/template/download/url/${$}`,method:"get"})}const ue={class:"flex flex-col items-center justify-center"},de=y("span",{class:"color-#1D2129"},[c("将文件拖拽至此区域 或 "),y("span",{class:"color-main"},"选择文件")],-1),re=y("div",{class:"line-height-22px mb8px"},"导入文件须知：",-1),pe=y("div",{class:"color-#86909C text-14px line-height-24px"},"1.文件类型:Excel格式",-1),ce=y("div",{class:"color-#86909C text-14px line-height-24px"},"2.文件大小限制:不得超过100w行",-1),me=y("div",{class:"color-#86909C text-14px line-height-24px"},"3.文件不支持表格合并",-1),_e=y("div",{class:"color-#86909C text-14px line-height-24px"},"4.确认上传文件表头是否与模版一致",-1),fe=y("div",{class:"color-#86909C text-14px line-height-24px"},"5.表格应为纯数值，不能带有“元”，“万”等单位",-1),ve={class:"flex items-center"},be=A({__name:"upload-file",props:{modalTitle:{},editData:{}},emits:["close"],setup($,{emit:m}){var k;const L=$,i=(k=R())==null?void 0:k.proxy,r=f(!1),C=f([]),a=(p=!1)=>{m("close",p)},N=()=>{if(C.value.length===0)return i==null?void 0:i.$message.warning("请选择上传文件！");r.value=!0;const p=C.value.map(u=>({...u,id:L.editData.id}));Y(p).then(({msg:u})=>{i==null||i.$message.success(u??"操作成功"),a(!0)}).finally(()=>{r.value=!1})},V=async()=>{const p=await se("crowd_package_template");p.data&&J(`https://cbd-bigdata.oss-cn-hangzhou.aliyuncs.com/${p.data}`)};return(p,u)=>{const t=s("ly-svg-icon"),x=s("LyUpload"),v=s("el-button"),b=s("el-dialog");return h(),q(b,{title:p.modalTitle,"model-value":!0,width:"50%","close-on-click-modal":!1,"before-close":()=>a()},{footer:l(()=>[y("span",ve,[e(v,{type:"primary",plain:"",onClick:V},{default:l(()=>[c("下载模板")]),_:1}),e(v,{class:"mlauto!",loading:r.value,onClick:u[1]||(u[1]=g=>a())},{default:l(()=>[c("取消")]),_:1},8,["loading"]),e(v,{loading:r.value,type:"primary",onClick:N},{default:l(()=>[c(" 提交 ")]),_:1},8,["loading"])])]),default:l(()=>[e(x,{drag:"",modelValue:C.value,"onUpdate:modelValue":u[0]||(u[0]=g=>C.value=g)},{trigger:l(()=>[y("div",ue,[e(t,{class:"w40px! h40px! mb16px","icon-class":"upload"}),de])]),_:1},8,["modelValue"]),re,pe,ce,me,_e,fe]),_:1},8,["title","before-close"])}}}),ge={key:0},ye={key:1},Ce=A({name:"internal-menu"}),Ne=A({...Ce,setup($){var E;const m=(E=R())==null?void 0:E.proxy,L=K(),i=f({classification:"",tableName:"",tableNa:"",tableType:""}),r=f(!1),C=f([]),a=f({pageSize:10,pageNo:1,total:0}),N=f({}),V=f(!1),k=f(),p=f(),u=()=>{a.value={pageSize:10,pageNo:1,total:0}},t=()=>{r.value=!0,Z({...i.value,...a.value}).then(_=>{a.value.total=_.data.totalNumber,C.value=_.data.list}).finally(()=>{r.value=!1})};t();function x(){u(),C.value=[],t()}function v(){m==null||m.$resetForm("queryRef"),u(),t()}const b=f(!1),g=(_,o)=>{if(_==="add"){V.value=!0,k.value="新建表",N.value={tableCode:`CREATE TABLE data_example (
        data_example_name varchar(32) DEFAULT NULL COMMENT '样例字段名称',
        data_example_type varchar(32) DEFAULT NULL COMMENT '样例类型',
        create_person varchar(32) DEFAULT NULL COMMENT '创建人',
        update_person varchar(32) DEFAULT NULL COMMENT '更新人'
      ) ENGINE=InnoDB COMMENT='样例表';`},p.value=ee;return}if(_==="edit"&&o){V.value=!0,k.value="编辑表",p.value=le,N.value={...o};return}if(_==="upload"&&o){b.value=!0,k.value="上传文件",N.value={...o};return}if(_==="delete"&&o){m==null||m.$messageBox.confirm("是否确定删除","删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",callback(d){d==="confirm"&&ae(o).then(({msg:U})=>{t(),m==null||m.$message.success(U??"删除成功")})}});return}_==="record"&&o&&L.push({path:"/tools/upload-record",query:{id:o.id}})},M=_=>{V.value=!1,b.value=!1,_&&t()};return(_,o)=>{const d=s("el-input"),U=s("el-form-item"),P=s("el-option"),I=s("el-select"),T=s("el-button"),Q=s("el-form"),z=s("LyPageWrapper"),D=s("el-table-column"),W=s("el-table"),j=s("ly-pagination"),G=O("loading");return h(),B("div",null,[e(z,{title:"查询条件",class:"mb16px"},{default:l(()=>[e(Q,{ref:"queryRef",model:i.value,inline:!0},{default:l(()=>[e(U,{prop:"classification"},{default:l(()=>[e(d,{modelValue:i.value.classification,"onUpdate:modelValue":o[0]||(o[0]=n=>i.value.classification=n),placeholder:"请输入分类",clearable:"",maxlength:"50"},null,8,["modelValue"])]),_:1}),e(U,{prop:"tableName"},{default:l(()=>[e(d,{modelValue:i.value.tableName,"onUpdate:modelValue":o[1]||(o[1]=n=>i.value.tableName=n),placeholder:"请输入表名称",clearable:"",maxlength:"50"},null,8,["modelValue"])]),_:1}),e(U,{prop:"tableNa"},{default:l(()=>[e(d,{modelValue:i.value.tableNa,"onUpdate:modelValue":o[2]||(o[2]=n=>i.value.tableNa=n),placeholder:"请输入表名",clearable:"",maxlength:"50"},null,8,["modelValue"])]),_:1}),e(U,{prop:"tableType"},{default:l(()=>[e(I,{modelValue:i.value.tableType,"onUpdate:modelValue":o[3]||(o[3]=n=>i.value.tableType=n),class:"select-brand",placeholder:"请选择表类型",clearable:"",style:{width:"200px"},onClear:u},{default:l(()=>[e(P,{label:"全量表",value:"1"}),e(P,{label:"增量表",value:"2"})]),_:1},8,["modelValue"])]),_:1}),e(U,null,{default:l(()=>[e(T,{type:"primary",icon:"Search",loading:r.value,onClick:o[4]||(o[4]=n=>x())},{default:l(()=>[c(" 搜索 ")]),_:1},8,["loading"]),e(T,{icon:"Refresh",loading:r.value,onClick:v},{default:l(()=>[c(" 重置 ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),e(z,{title:"手工表"},{toolButton:l(()=>[e(T,{type:"primary",icon:"plus",onClick:o[5]||(o[5]=n=>g("add"))},{default:l(()=>[c(" 新建表 ")]),_:1})]),default:l(()=>[S((h(),q(W,{data:C.value},{default:l(()=>[e(D,{label:"分类",prop:"classification"}),e(D,{label:"表名",prop:"tableNa"}),e(D,{label:"表类型",prop:"tableType"},{default:l(({row:n})=>[n.tableType==="1"?(h(),B("span",ge,"全量表")):n.tableType==="2"?(h(),B("span",ye,"增量表")):w("",!0)]),_:1}),e(D,{label:"创建时间",prop:"createTime"}),e(D,{label:"更新时间",prop:"updateTime"}),e(D,{label:"操作",align:"center",width:"300",fixed:"right"},{default:l(({row:n})=>[e(T,{type:"primary",link:"",plain:"",onClick:F=>g("view",n)},{default:l(()=>[c(" 查看 ")]),_:2},1032,["onClick"]),e(T,{type:"primary",link:"",plain:"",onClick:F=>g("edit",n)},{default:l(()=>[c(" 编辑 ")]),_:2},1032,["onClick"]),e(T,{type:"primary",link:"",plain:"",onClick:F=>g("delete",n)},{default:l(()=>[c(" 删除 ")]),_:2},1032,["onClick"]),e(T,{type:"primary",link:"",plain:"",onClick:F=>g("upload",n)},{default:l(()=>[c(" 上传文件 ")]),_:2},1032,["onClick"]),e(T,{type:"primary",link:"",plain:"",onClick:F=>g("record",n)},{default:l(()=>[c(" 上传记录 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[G,r.value]]),S(e(j,{page:a.value.pageNo,"onUpdate:page":o[6]||(o[6]=n=>a.value.pageNo=n),limit:a.value.pageSize,"onUpdate:limit":o[7]||(o[7]=n=>a.value.pageSize=n),total:a.value.total,onPagination:t},null,8,["page","limit","total"]),[[X,a.value.total>0]])]),_:1}),V.value?(h(),q(ie,{key:0,"modal-title":k.value,"edit-data":N.value,"request-api":p.value,onClose:M},null,8,["modal-title","edit-data","request-api"])):w("",!0),b.value?(h(),q(be,{key:1,"modal-title":k.value,"edit-data":N.value,onClose:M},null,8,["modal-title","edit-data"])):w("",!0)])}}});export{Ne as default};
//# sourceMappingURL=index-dbde4c29.js.map
